<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <title>IV Mostra</title>
    
    <link href="http://code.jquery.com/mobile/1.4.0/jquery.mobile-1.4.0.min.css" rel="stylesheet" type="text/css" />
    <script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.0/jquery.mobile-1.4.0.min.js"></script>
    
    <script src="http://maps.google.com/maps/api/js?sensor=true"></script>

    <script src="http://www.rachandotaxi.com.br/js/jquery-ui-maps/min/jquery.ui.map.full.min.js"></script>
    <script src="http://www.rachandotaxi.com.br/js/jquery-ui-maps/jquery.ui.map.extensions.js"></script>

    <style>
      .navbar-main-bottom-fixed {
        position: fixed;
        bottom: 0;
      }

      #map_canvas {
        width: 100%;
        height: 270px;
      }
    </style>
  </head>
  <body>
    <!-- SEC 01: IV Mostra -->
    <div data-role="page" id="one">
      <!-- content -->
      <div role="main" class="ui-content">
        <h2>IV Mostra</h2>

        <p>Conteúdo Apresentação IV Mostra</p>
      </div>
      <!-- # content -->

      <!-- Navbar -->
      <div data-role="navbar" class="navbar-main-bottom-fixed">
        <ul>
          <li><a href="#one" id="chat" data-icon="custom">IV Mostra</a></li>
          <li><a href="#prog" id="beer" data-icon="custom">Programação</a></li>
          <li><a href="#maps" id="beer" data-icon="custom">Mapa(s)</a></li>
          <li><a href="#social" id="coffee" data-icon="custom">Compartilhe!</a></li>
        </ul>
      </div>
      <!-- # Navbar -->
    </div>
    <!-- # SEC 01: IV Mostra -->

    <!-- SEC 02: Programação -->
    <div data-role="page" id="prog">
      <!-- content -->
      <div role="main" class="ui-content" >
        <h2>Programação</h2>

        <p>Programação IV Mostra</p>
      </div>
      <!-- # content -->

      <!-- Navbar -->
      <div data-role="navbar" class="navbar-main-bottom-fixed">
        <ul>
          <li><a href="#one" id="chat" data-icon="custom">IV Mostra</a></li>
          <li><a href="#prog" id="beer" data-icon="custom">Programação</a></li>
          <li><a href="#maps" id="beer" data-icon="custom">Mapa(s)</a></li>
          <li><a href="#social" id="coffee" data-icon="custom">Compartilhe!</a></li>
        </ul>
      </div>
      <!-- # Navbar -->
    </div>
    <!-- # SEC 02: Programação -->

    <!-- SEC 03: Maps -->
    <div data-role="page" id="maps" data-theme="a">
      <!-- content -->
      <div role="main" class="ui-content">
        <h2>Maps</h2>

        <p>Mapas aqui...</p>
        <div id="map_canvas"></div>

        <p id="geolocation">Finding geolocation...</p>

        <button onclick="irParaLocal()">Chegar ao Evento</button>
        <div id="panel"></div> 
      </div>
      <!-- # content -->

      <!-- Navbar -->
      <div data-role="navbar" class="navbar-main-bottom-fixed">
        <ul>
          <li><a href="#one" id="chat" data-icon="custom">IV Mostra</a></li>
          <li><a href="#prog" id="beer" data-icon="custom">Programação</a></li>
          <li><a href="#maps" id="beer" data-icon="custom">Mapa(s)</a></li>
          <li><a href="#social" id="coffee" data-icon="custom">Compartilhe!</a></li>
        </ul>
      </div>
      <!-- # Navbar -->
    </div>
    <!-- # SEC 03: Maps -->

    <!-- SEC 04: Social -->
    <div data-role="page" id="social">
      <!-- content -->
      <div role="main" class="ui-content" >
        <h2>Social</h2>

        <h4>Social IV Mostra</h4>
        <p>Compartilhe no Facebook</p>
        <p>Siga-nos nas redes sociais (Twitter)</p>
      </div>
      <!-- # content -->

      <!-- Navbar -->
      <div data-role="navbar" class="navbar-main-bottom-fixed">
        <ul>
          <li><a href="#one" id="chat" data-icon="custom">IV Mostra</a></li>
          <li><a href="#prog" id="beer" data-icon="custom">Programação</a></li>
          <li><a href="#maps" id="beer" data-icon="custom">Mapa(s)</a></li>
          <li><a href="#social" id="coffee" data-icon="custom">Compartilhe!</a></li>
        </ul>
      </div>
      <!-- # Navbar -->
    </div>
    <!-- # SEC 04: Social -->

    <script type="text/javascript">
      var minha_posicao = null

      $("#maps").bind('pageinit', function() {
        $('#map_canvas').gmap().bind('init', function(ev, map) {
          $('#map_canvas').gmap('addMarker', {'position': '-15.816307,-47.8439705', 'bounds': true}).click(function() {
            $('#map_canvas').gmap('openInfoWindow', {'content': 'Hello World!'}, this);
          });
        });
        $('#map_canvas').gmap('option', 'zoom', 13);
        $('#map_canvas').gmap('refresh');
      });

      $("#maps").bind('pageshow', function() {
        $('#map_canvas').gmap('refresh');
      });
     
      /**
       * Atualiza o Mapa com o zoom e o circulo
       */
      function changeZoom(){

        setTimeout(function(){
          $('#map_canvas').gmap('option', 'zoom', 13);
          $('#map_canvas').gmap('refresh');
        },2000);
      }   

      /**
       * Pega o sua direção e localiza com o evento
       **/               
      function irParaLocal(){
        var posicao_atual = ""+ position.coords.latitude  + "," + position.coords.longitude+"" ;
        alert(posicao_atual);
        $('#map_canvas').gmap('destroy');
        $('#map_canvas').gmap().bind('init', function(evt, map) { 
        $('#map_canvas').gmap('displayDirections', { 'origin': posicao_atual, 'destination': '-15.816307,-47.8439705', 'travelMode': google.maps.DirectionsTravelMode.DRIVING }, { 'panel': document.getElementById('panel') }, function(result, status) {
            if ( status === 'OK' ) {
              //alert('Results found!');
            }
          });                                                                                                        
        });
        $('#map_canvas').gmap('refresh');
      }  

      document.addEventListener("deviceready", onDeviceReady, false);

      // device APIs are available
      //
      function onDeviceReady() {
        navigator.geolocation.getCurrentPosition(onSuccess, onError);
      }

      // onSuccess Geolocation
      //
      function onSuccess(position) {
        var element = document.getElementById('geolocation');
        minha_posicao = position;
        element.innerHTML = 'Latitude: '           + position.coords.latitude              + '<br />' +
                            'Longitude: '          + position.coords.longitude             + '<br />';
      }

      // onError Callback receives a PositionError object
      //
      function onError(error) {
        alert('code: '    + error.code    + '\n' +
              'message: ' + error.message + '\n');
      }
    </script>

    <!-- If development: Livereload -->
    <script type="text/javascript" src="http://localhost:35729/livereload.js"></script>
    <!-- END: Livereload -->
  </body>
</html>